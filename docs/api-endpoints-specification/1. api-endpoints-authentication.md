## 1. Authentication

### 1.1 Register

**Description**: Creates a new user or owner account and sends a verification email.

**HTTP Method**: POST  
**Endpoint**: `/api/auth/register`  
**Authorization**: None

**Request Body**:

```json
{
  "email": "user@example.com",
  "password": "Password123!",
  "confirmPassword": "Password123!",
  "fullName": "Nguyen Van A",
  "phone": "0909123456",
  "role": "User" // or "Owner"
}
```

**Response**:

- **201 Created**:

  ```json
  {
    "accountId": 123,
    "token": "...",
    "refreshToken": "...",
    "message": "Account registered successfully. Please verify your email."
  }
  ```

- **400 Bad Request**:

  ```json
  {
    "error": "Invalid input",
    "details": "..."
  }
  ```

- **409 Conflict**:

  ```json
  {
    "error": "Email already exists",
    "details": "Email already exists."
  }
  ```

- **500 Internal ServerError**:
  ```json
  {
    "error": "Internal server error",
    "details: "Failed to send verification email."
  }
  ```

**Note**:

- `role` phải là `"User"` hoặc `"Owner"`.
- Sends a verification email with a link containing `email` and `token`.
- `Account.Email` is unique.

### 1.2 Login

**Description**: Authenticates a user or owner and returns tokens.

**HTTP Method**: POST  
**Endpoint**: `/api/auth/login`  
**Authorization**: None

**Request Body**:

```json
{
  "email": "user@example.com",
  "password": "Password123!"
}
```

**Response**:

- **200 OK**:

  ```json
  {
    "token": "...",
    "refreshToken": "...",
    "expiresIn": 3600,
    "role": "User",
    "message": "Login successful"
  }
  ```

- **400 Bad Request**:

  ```json
  {
    "error": "Invalid input",
    "details": "..."
  }
  ```

- **401 Unauthorized**:
  ```json
  {
    "error": "Unauthorized",
    "details": "Invalid email or password"
  }
  ```

**Note**:

- Updates `Account.LastLogin` on successful login.
- `role` indicates the account type (`User` or `Owner`).

### 1.3 Refresh Token

**Description**: Refreshes the access token using a refresh token.

**HTTP Method**: POST  
**Endpoint**: `/api/auth/refresh-token`  
**Authorization**: None

**Request Body**:

```json
{
  "refreshToken": "...refresh_token"
}
```

**Response**:

- **200 OK**:

  ```json
  {
    "token": "...",
    "refreshToken": "...",
    "expiresIn": 3600,
    "message": "Token refreshed successfully"
  }
  ```

- **400 Bad Request**:

  ```json
  {
    "error": "Invalid input",
    "details": "..."
  }
  ```

- **401 Unauthorized**:
  ```json
  {
    "error": "Unauthorized",
    "details": "Invalid or expired refresh token"
  }
  ```

### 1.4 Forgot Password

**Description**: Sends a password reset email with a link.

**HTTP Method**: POST  
**Endpoint**: `/api/auth/forgot-password`  
**Authorization**: None

**Request Body**:

```json
{
  "email": "user@example.com"
}
```

**Response**:

- **200 OK**:

  ```json
  {
    "message": "Password reset email sent"
  }
  ```

- **400 Bad Request**:

  ```json
  {
    "error": "Invalid input",
    "details": "..."
  }
  ```

- **404 Not Found**:
  ```json
  {
    "error": "Email not found",
    "details": "Email does not exist."
  }
  ```

**Note**:

- Generates `AccountId.AccountId` and sends it via email.

### 1.5 Reset Password

**Description**: Resets the password using a reset token.

**HTTP Method**: POST  
**Endpoint**: `/api/reset-password`  
**Authorization**: None

**Request Body**:

```json
{
  "email": "user@example.com",
  "token": "...",
  "newPassword": "NewPassword123!"
}
```

**Response**:

- **200 OK**:

  ```json
  {
    "message": "Password reset successfully"
  }
  ```

- **400 Bad Request**:

  ```json
  {
    "error": "Invalid input",
    "details": "..."
  }
  ```

- **404 Not Found**:
  ```json
  {
    "error": "Invalid or expired token",
    "details": "Invalid or expired reset token."
  }
  ```

**Note**:

- Requires `email` for additional security.
- Clears `AccountId.ResetToken` after successful reset.

### 1.6 Logout

**Description**: Invalidates the refresh token for the authenticated user.

**HTTP Method**: POST  
**Endpoint**: `/api/auth/logout`  
**Authorization**: Bearer Token

**Request Body**:

```json
{
  "refreshToken": "...refresh_token"
}
```

**Response**:

- **200 OK**:

  ```json
  {
    "message": "Logged out successfully"
  }
  ```

- **400 Bad Request**:

  ```json
  {
    "error": "Invalid input",
    "details": "..."
  }
  ```

- **401 Unauthorized**:
  ```json
  {
    "error": "Unauthorized",
    "details": "Invalid refresh token"
  }
  ```

### 1.7 Get Current User

**Description**: Retrieves information of the authenticated user.

**HTTP Method**: GET  
**Endpoint**: `/api/auth/me`  
**Authorization**: Bearer Token

**Request**:

```http
GET /api/auth/me
Authorization: Bearer {token}
```

**Response**:

- **200 OK**:

  ```json
  {
    "accountId": "123",
    "email": "user@example.com",
    "role": "User",
    "fullName": "Nguyen Van A",
    "phone": "0909123456"
  }
  ```

- **401 Unauthorized**:
  ```json
  {
    "error": "Unauthorized",
    "details": "Invalid or expired token"
  }
  ```

### 1.8 Change Password

**Description**: Changes the password of the authenticated user.

**HTTP Method**: POST  
**Endpoint**: `/api/auth/change-password`  
**Authorization**: Bearer Token

**Request Body**:

```json
{
  "currentPassword": "OldPassword123!",
",
  "newPassword": "NewPassword123!""}
```

**Response**:

- **200 OK**:

  ```json
  {
    "message": "Password changed successfully"
  }
  ```

- **400 Bad Request**:

  ```json
  {
    "error": "Invalid input",
    "details": "Current password is incorrect"
  }
  ```

- **401 Unauthorized**:
  ```json
  {
    "error": "Unauthorized",
    "details": "Invalid or expired token"
  }
  ```

### 1.9 Verify Email

**Description**: Verifies the email address using a link sent via email.

**HTTP Method**: GET  
**Endpoint**: `/api/auth/verify-email?email={email}&token={token}`  
**Authorization**: None

**Request Parameters**:

- `email`: Email address of the account.
- `emailtoken`: Verification token.

**Response**:

- **302 Found**:
  - Redirects to `{FEUrl}/auth/verify-email?status=success&message=Email verified successfully`
  - Or `{FEUrl}/error?status=error&message=Invalid or expired token`

**Note**:

- Used in the verification link sent via email.
- Redirects to frontend with status and message.

### 1.10 Resend Verification Email

**Description**: Resends the verification email.

**HTTP Method**: POST  
**Endpoint**: `/api/auth/resend-verification-email`  
**Authorization**: None

**Request Body**:

```json
{
  "email": "user@example.com"
}
```

**Response**:

- **200 OK**:

  ```json
  {
    "message": "Verification email resent"
  }
  ```

- **400 Bad Request**:

  ```json
  {
    "error": "Invalid input",
    "details": "..."
  }
  ```

- **404 Not Found**:
  ```json
  {
    "error": "Email not found",
    "details": "Email does not exist."
  }
  ```

### 1.11 Verify Token

**Description**: Verifies the validity of an access token.

**HTTP Method**: POST  
**Endpoint**: `/api/auth/verify-token`  
**Authorization**: Bearer Token

**Request Body**:

```json
{
  "token": "...access_token"
}
```

**Response**:

- **200 OK**:

  ```json
  {
    "isValid": true,
    "role": "User",
    "message": "Token is valid"
  }
  ```

- **400 Bad Request**:

  ```json
  {
    "error": "Invalid input",
    "details": "..."
  }
  ```

- **401 Unauthorized**:
  ```json
  {
    "error": "Unauthorized",
    "details": "Invalid or expired token"
  }
  ```
